%%
% Строит графики результатов моделирования BER из папки results/

%%
% Параметры
folder = 'results/';
files = { ...
	'MF_ML_4_0.8_BPSK.mat'; ...
	'MF_ML_8_0.8_BPSK.mat'; ...
	'MF_TSVD_16_0.8_BPSK_13.mat'; ...
	'MF_IC_16_0.8_BPSK.mat'; ...
	'MF_MF_16_0.8_BPSK.mat'; ...
	'MF_ZF_16_0.8_BPSK.mat'; ...
	'MF_ID_16_0.8_BPSK_3.mat'; ...
	'MF_ID_16_0.8_BPSK_2.mat'; ...
	'MF_ID_16_0.8_BPSK_1.mat'; ...
% 	...
% 	'MF_TSVD_16_0.8_QPSK.mat'; ...
% 	'MF_IC_16_0.8_QPSK.mat'; ...
% 	'MF_MF_16_0.8_QPSK.mat'; ...
% 	'MF_ZF_16_0.8_QPSK.mat'; ...
};

line_spec = {
	'-*'; ...
	'-*'; ...
	'-*'; ...
	'-*'; ...
	'->'; ...
	'-<'; ...
	'-o'; ...
	'-+'; ...
	'-x'; ...
	'->'; ...
	'-<'
};

%%
% Read files
results = cell(length(files), 1);
for i = 1 : length(files)
	filename = [folder, files{i}];
	results{i} = load(filename);
end

%%
% Print
EbNo_bpsk = 0 : 12;
BER_bpsk = berawgn(EbNo_bpsk, 'psk', 2, 'nondiff');

figure;

hold on;
ax = gca;
ax.YScale = 'log';
ax.XLim = [0 10];

legend_text = cell(1, length(results) + 1);
plot(EbNo_bpsk, BER_bpsk, line_spec{1});
legend_text{1} = 'OFDM, BPSK/QPSK';
for i = 1 : length(results)

	plot(results{i}.EbNo, results{i}.BER, line_spec{i + 1});
	legend_text{i + 1} = ...
		[ results{i}.demodulation_algorithm, '-', results{i}.detection_algorithm, ...
		  ', N = ', num2str(results{i}.N_subcarrier), ...
		  ', a = ', num2str(results{i}.alfa), ...
		  ', ', results{i}.modulation_name ];

	% Specific information of detection algorithm
	switch results{i}.detection_algorithm
	case 'ID'
		legend_text{i + 1} = ...
			[ legend_text{i + 1}, ...
			  ', \nu = ', num2str(results{i}.nu) ];
	case 'TSVD'
		legend_text{i + 1} = ...
			[ legend_text{i + 1}, ...
			  ', \xi = ', num2str(results{i}.trunc_index) ];
	otherwise
	end

end

xlabel('Eb/No (dB)');
ylabel('BER');
grid on;
legend(legend_text);




